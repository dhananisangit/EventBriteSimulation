{% extends 'base.html' %}
{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
       <title>Title</title>
    <link rel="stylesheet"; type="text/css"; href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css">
</head>
<body>
{% block content %}
<h1><b>List of events:</b></h1>
    <div id="events" ></div>
<script>
    var currurl = window.location.search.substring(1);
    currurl+=3;
    var queryStart = currurl.indexOf("?")+ 1;
    var queryEnd = currurl.indexOf(currurl.length)+1;
    var events = currurl.slice(queryStart,queryEnd-1);
    var code="";
    //alert(events);
     var VariableArray = events.split('&');
    for(var i = 0; i < VariableArray.length; i++){
        var Value = VariableArray[i].split('=');
        code += Value[1];
        if(i<2)
        {
            code+=",";
        }
    }


  var getJSON = function(url) {
  return new Promise(function(resolve, reject) {
    var xhr = new XMLHttpRequest();
    xhr.open('get', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        resolve(xhr.response);
      } else {
          alert("hello");
        reject(status);
      }
    };
    xhr.send();
  });
}


    var jsonData=getJSON('https://www.eventbriteapi.com/v3/events/search/?categories='+code+'&token=ESS74QGJ4DENACAOB5MA').then(function(data)
 {
    var sjd="";
    for(var i=0; i<data.events.length; i++)
     {
         var url=data.events[i].url;
         var startdate=data.events[i].start.local;
         var splitstartdate=startdate.split("T");
         var time=splitstartdate[1].split(":");
         var zone=data.events[i].start.timezone;
         var splitzone=zone.split("/");
         sjd+='<h4>'+ "<br/>"+'<b>'+ data.events[i].name.text +'</b>'+
              '<a href="'+url+'">' + ' Buy tickets' + '</a>'+'<br>'+'</h4>'+
              '<h5>'+' Event on '+splitstartdate[0]+" At "+ time[0]+":"+time[1]+ ' in '+splitzone[1] +'</h5>'+
              '<h6>'+data.events[i].description.text+ '<br>'+'</h6>';
     }
     document.getElementById("events").innerHTML = sjd ;
 }
 );

</script>

    <div class="container">
    <ul class="pagination pagination-lg">
        <li><a href="">&laquo;</a></li>
        <li class="active"><a href="">1</a></li>
        <li><a href="#">2</a></li>
        <li><a href="#">3</a></li>
        <li><a href="#">4</a></li>
        <li><a href="#">5</a></li>
        <li><a href="#">&raquo;</a></li>
    </ul>
    </div>
{% endblock %}
</body>
</html>








{% extends 'base.html' %}
{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
<h1>EventBrite</h1>
</head>
<body>
{% block content %}
    <h1>Select 3 categories of events which you would like to attend.</h1>
    <br/>
<div id="result" style="text-align:center">
</div>
<script>
   var getJSON = function(url) {
  return new Promise(function(resolve, reject) {
    var xhr = new XMLHttpRequest();
    xhr.open('get', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        resolve(xhr.response);
      } else {
        reject(status);
      }
    };
    xhr.send();
  });
};

 var jsonData=getJSON('https://www.eventbriteapi.com/v3/categories/?token=ESS74QGJ4DENACAOB5MA').then(function(data)
 {
     var sjd='<form action="http://127.0.0.1:8000/categorized/" method="GET">';
    for(var i=0; i<data.categories.length; i++)
     {
        sjd +='<h4>'+ "<br/>" +'<input type="checkbox" name="events" value='+data.categories[i].id+'>'+ data.categories[i].name + '<br>'+'</h4>';
     }
     sjd+='<input type="submit" value="Submit" onClick="getEventData()">';
     sjd+='</form>';
     document.getElementById("result").innerHTML = sjd ;
 }
 );

function getEventData(){
    var eventList = document.getElementsByName("events");
    var k=0;
    var eventbrite = "https://www.eventbriteapi.com/v3/events/search/?categories=";
    for(var i=0;i<eventList.length;i++){
        if(k>=3)
            break;
        if(eventList[i].checked){
            if(k==2)
                eventbrite+=eventList[i].value+"";
            else
                eventbrite+=eventList[i].value+",";
            k++;
        }
    }
    if(k<3){
        alert("Please select 3 categories");
        return;
    }
}
</script>
{% endblock %}
</body>
</html>
